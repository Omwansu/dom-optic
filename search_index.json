[
["index.html", "Practical guide on dissolved organic matter (DOM) optic Chapter 1 Introduction and motivations", " Practical guide on dissolved organic matter (DOM) optic Philippe Massicotte 2017-07-07 Chapter 1 Introduction and motivations Dissolved organic matter (DOM) plays a central role in the functioning of aquatic ecosystems. For example, characteristics of the DOM pool (quantity and quality) determine underwater light climate (Kirk 1994), the composition of aquatic microbial communities (Foreman and Covert 2003; Kritzberg et al. 2006) and the carbon cycling on local to global scales (J. J. Cole et al. 2007). Chemically, the DOM pool is complex (&gt; 1500 compounds) and analytical methods used to characterize it are relatively complex, time-consuming and costly (Benner 2002; Seitzinger et al. 2005; Jason B Fellman, Hood, and Spencer 2010). This situation called for the development of rapid and cost effective characterization techniques. Because optical properties of DOM can be related to its chemical properties, optical techniques such as fluorescence spectroscopy have been developed and rapidly adopted by the community to characterize the DOM pool in aquatic ecosystems (Paula G Coble et al. 1990; Paula G Coble 1996; McKnight et al. 2001; J B Fellman et al. 2008). This document aims at providing practical tools that can serve as a starter to those who desire to start working with DOM. R code examples are also provided. For those that are interested to learn in depth DOM biogeochemistry, there are excellent sources of fundamental information in the following books: Lakowicz (2006) Hansell and Carlson (2014) Findlay and Sinsabaugh (2003) P. Coble et al. (2014) References "],
["measurements.html", "Chapter 2 Measurements ", " Chapter 2 Measurements "],
["dom-measurements.html", "2.1 DOM measurements", " 2.1 DOM measurements How DOM is measured (different filter sizes, paper in L&amp;O). Pump pression -->"],
["absorbance.html", "Chapter 3 Absorbance ", " Chapter 3 Absorbance "],
["what-is-cdom.html", "3.1 What is CDOM?", " 3.1 What is CDOM? Chromophoric fraction of the DOM pool (CDOM) is a major driver of underwater light characteristics (Kirk1994) which modulate many bio-optical processes such as primary production (Thrane2014, Seekell2015) and also constitute a natural screen protecting aquatic organisms against harmful ultraviolet (UV) radiations (Boily2012). Because of its colored nature, CDOM is known to strongly absorbs UV light. Blough and Vecchio (2002) provide a good definition of what is CDOM. Over the past decade, there has been a renewed interest in the properties and distribution of the major light-absorbing constituent of the (DOM) pool in natural waters (the 0.2 \\(μ\\)m fraction). This material—referred in the past by various names such as Gelbstoff, yellow substance, gilvin, and humic substances) has more recently been provided the name chromophoric dissolved organic matter (CDOM). Measured in quartz cuvette (1, 5, 10+ cm) References "],
["writing-and-notation.html", "3.2 Writing and notation", " 3.2 Writing and notation In reference to this fraction of the DOM pool, people have been using interchangeably different terminology. For example, a_g(\\(\\lambda\\)), a(\\(\\lambda\\)), CDOM(\\(\\lambda\\)), aCDOM(\\(\\lambda\\)) and \\(a_{CDOM}(\\lambda)\\) are all referring to the absorption coefficient measured at wavelength \\(\\lambda\\) (nm). To unify the terminology, we propose that absorption of CDOM should be written as \\(\\mathbf{a_{\\text{CDOM}}(\\lambda)}\\) using the followings rules: a in italic to reference to absorption (vs absorbance). CDOM subscript and in capital letters. \\(\\lambda\\) sign to refer to the wavelength where the measurement is done. For example, \\(a_{\\text{CDOM}}(350)\\) refers to absorption coefficient measured at 350 nm. "],
["absorption-vs-absorbance.html", "3.3 Absorption vs absorbance", " 3.3 Absorption vs absorbance It is of interest to review the Beer-Lambert law to understand the difference between absrobance and absorption. \\[\\begin{alignat}{2} \\label{eq:abs1} I_n &amp;= I_0 \\times e^{(\\epsilon \\times c \\times L)}\\\\ \\end{alignat}\\] where: \\(I_0\\) the intensity of emitted light (before it passes through the sample). \\(I_n\\) the intensity of received light (after it passes through the sample). \\(\\epsilon\\): the molar absorption coefficient (\\(m^2 \\times \\text{mole}^{-1}\\)). \\(c\\): the concentration of the colored material in the solution (\\(\\text{mole} \\times m^{-3}\\)). \\(L\\): the pathlenght traveled by the light throught the solution. It is of a common usage to express it per meter (\\(m^{-1}\\)). \\[\\begin{alignat}{2} \\label{eq:abs2} I_n &amp;= I_0 \\times e^{-(a \\times L)}\\\\ \\end{alignat}\\] where \\(a = \\epsilon \\times c\\) is the absorption coefficient (\\(m^{-1}\\)). \\[\\begin{alignat}{2} \\label{eq:abs3} \\frac{I_n}{I_0} &amp;= e^{-(a \\times L)}\\\\[10pt] \\frac{I_0}{I_n} &amp;= e^{(a \\times L)}\\\\[10pt] log(\\frac{I_0}{I_n}) &amp;= a \\times L\\\\[10pt] a &amp;= \\frac{log(\\frac{I_0}{I_n})}{L}\\\\ \\end{alignat}\\] We notice here that the Beer-Lambert law is written in log base \\(e\\). However, for historical reasons (basically because it was esier to calculate in the old days), spectrophotometer use log base 10 than rather than \\(e\\). To convert from base 10 logarithm to a natural logarithm (i.e. base \\(e\\)), one need to use the conversion factor calculated as \\(log(10)\\) which is equato to 2.3025851. Then, the equation becomes: \\[\\begin{alignat}{2} \\label{eq:abs4} a &amp;= \\frac{log(\\frac{I_0}{I_n}) \\times 2.303}{L}\\\\ \\end{alignat}\\] Note that absorbance measured by spectrophotometers is noted \\(A\\). Finally, \\[\\begin{equation} a = \\frac{A \\times 2.303}{L} \\label{eq:absorption1} \\end{equation}\\] Because we are specifically measuring absorption of CDOM, often at a specific wavelength \\(\\lambda\\), the recommended writing is as follow: \\[\\begin{equation} a_{\\text{CDOM}}(\\lambda) = \\frac{A(\\lambda) \\times 2.303}{L} \\label{eq:absorption2} \\end{equation}\\] Where \\(A(\\lambda)\\) is the measured absorbance and \\(L\\) the measurement cuvette thickness (or pathlenght) expressed per meter (\\(m^{-1}\\)). "],
["mathematical-formulation-of-absorption-spectra.html", "3.4 Mathematical formulation of absorption spectra", " 3.4 Mathematical formulation of absorption spectra As observed in figure 3.1, absorption decrease exponentially with increasing wavelengths. As wavelengths increase, light absorbed by CDOM decrease exponentially 3.1. library(cdom) data(spectra) spectra &lt;- spectra %&gt;% filter(wavelength &lt;= 500) p &lt;- ggplot(spectra, aes(x = wavelength, y = spc1)) + geom_line() + xlab(&quot;Wavelength (nm.)&quot;) + ylab(bquote(Absorption~(nm^{-1}))) p FIGURE 3.1: Example of an absorption spectrum of CDOM. Jerlov (1968) and Bricaud, Morel, and Prieur (1981) first proposed to use a simple exponential formulation to model absorption (equation (??)). \\[\\begin{equation} a_{\\text{CDOM}}(\\lambda) = a_{\\text{CDOM}}(\\lambda0)e^{-S(\\lambda - \\lambda0)} \\label{eq:cdom1} \\end{equation}\\] Where \\(a_{\\text{CDOM}}(\\lambda)\\) is the absorption coefficient (m\\(^{-1}\\)), \\(\\lambda\\) is the wavelength (nm), \\(\\lambda0\\) is a reference wavelength (nm) and \\(S\\) is the spectral slope (nm\\(^{-1}\\)) that describes the approximate exponential rate of decrease of absorption with increasing wavelength. Higher slopes indicate a more rapid decrease in absorption with increasing wavelength. The \\(S\\) parameter is frequently used as a proxy for tracing photochemical and microbial-induced changes of CDOM (Moran, Sheldon, and Zepp 2000; Twardowski et al. 2004; Helms et al. 2013) or to determine its origin (C A Stedmon and Markager 2001). In 2001, equation (??) was modified by C A Stedmon and Markager (2001) which introduced \\(k\\), a background constant (m\\(^{-1}\\)) accounting for scatter in the cuvette and drift of the instrument (equation (??)). \\[\\begin{equation} a_{\\text{CDOM}}(\\lambda) = a_{\\text{CDOM}}(\\lambda0)e^{-S(\\lambda - \\lambda0)} + \\mathbf{k} \\label{eq:cdom2} \\end{equation}\\] The \\(K\\) parameter… Graph showing \\(K\\) There are other mathematical formulations that can be used to model CDOM spectra. These are reviewed in Twardowski et al. (2004). References "],
["sl.html", "3.5 Modeling CDOM absorption spectra in R", " 3.5 Modeling CDOM absorption spectra in R Because of it inverse exponential shape, absorption spectra are best modeled using non-linear fittings. In R this is done easy using the nls() function. As we can see from equation (??), the most commonly equation used to model CDOM spectra contains three parameters: a0, s, k. mod &lt;- nls(spc1 ~ a0 * exp(-s * (wavelength - 250)) + k, # define the formula data = spectra, # where the data comes from start = list(a0 = 5, s = 0.02, k = 0)) # initial guesses. # show the summary information summary(mod) ## ## Formula: spc1 ~ a0 * exp(-s * (wavelength - 250)) + k ## ## Parameters: ## Estimate Std. Error t value Pr(&gt;|t|) ## a0 1.536e+01 4.778e-01 32.15 &lt;2e-16 *** ## s 4.070e-02 5.989e-04 67.96 &lt;2e-16 *** ## k 4.154e+00 2.871e-01 14.47 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 4.187 on 308 degrees of freedom ## ## Number of iterations to convergence: 7 ## Achieved convergence tolerance: 3.221e-06 The value of \\(a0\\) is 15.36 represent the absorption coefficient at the reference wavelength of 250 nm (Fig. 3.2). The value of \\(S\\) is 0.04 means that absorption is decreasing at a rate of 0.04 \\(m^{-1}\\) for each increase of 1 nm. cdom package example k parameter (scattering, introduced by C A Stedmon and Markager (2001)) p + geom_line(aes(y = predict(mod)), col = &quot;red&quot;) + geom_hline(yintercept = coef(mod)[1] + coef(mod)[3], lty = 2) + geom_vline(xintercept = 250, lty = 2) FIGURE 3.2: Predicted values of the exponential model. 3.5.1 Potential drawbacks When modeling CDOM spectra, there are few things to keep in minds that can have a significant influence on model results. 3.5.1.1 Choice of the reference wavelength In equation (??), the reference wavelength was set at 350 nm. One question can potentially come to your mind. What is the effect of choosing a different reference wavelengths? What will append to \\(S\\) if we change the reference wavelength to let’s say 250? Fig. 3.3 shows that: Little effect (computational rounding) FIGURE 3.3: Effect of varying the reference wavelength on S. Plot the calculated curves on a graph 3.5.1.2 Choice of the spectral range The choice of the spectral range used to model absorption spectra is known to have important consequences on estimated parameters (Massicotte and Markager 2016; Twardowski et al. 2004). I will use the spectrum provided in Fig. 3.1 where absorption has been measured between 190 and 900 nm. For this exercise, I will use four different spectral ranges to show how this is affecting the calculation of \\(S\\). 275-295 nm 350-450 nm 220-600 nm 250-500 nm FIGURE 3.4: Effect of wavelength range on modeled absorption. Can have important effect on the value of \\(S\\). S K a0 0.0088350 -16.0281500 17.168865 0.0197242 0.8640024 3.688161 0.0197387 1.1424607 3.264979 0.0170917 0.4973948 4.313748 References "],
["metrics.html", "3.6 Metrics", " 3.6 Metrics \\(S_{300-600}\\) linked to DOM molecular weight (Colin A. Stedmon and Nelson 2015). 3.6.1 Slope ratio Equation (??) shows how the slope ratio (\\(S_R\\)) is calculated. \\[\\begin{equation} S_R = \\frac{S_{275-295}}{S_{350-400}} \\label{eq:sr} \\end{equation}\\] By calculating the ratio of the slope of the shorter wavelength region (275–295 nm) to that of the longer wavelength region (350–400 nm), a dimensionless parameter called “slope ratio” or \\(S_R\\) is defined. This approach avoids the use of spectral data near the detection limit of the instruments used, and focuses on absorbance values that shift dramatically during estuarine transit and photochemical alteration of CDOM (Helms et al. 2008). Figure 3.5 shows in red the 275-295 and 350-400 nm spectral range. FIGURE 3.5: Spectral range used to calculate the slope ratio. --> References "],
["fluorescence.html", "Chapter 4 Fluorescence ", " Chapter 4 Fluorescence "],
["what-is-a-eem.html", "4.1 What is a EEM", " 4.1 What is a EEM FIGURE 4.1: Example of an excitation-emission fluorescence matrix (EEM). The diagonal structure with high fluorescence corresponds to the first order of Rayleigh scattering. "],
["parafac.html", "4.2 PARAFAC", " 4.2 PARAFAC The seminal paper of (Colin A. Stedmon, Markager, and Bro 2003) put at the forefront the use of parallel factor analysis (PARAFAC) to aid the characterization of fluorescent DOM. Briefly, this three-way technique allows the decomposition of complex DOM fluorescence signals contained in the excitation-emission matrix (EEM, Fig. 1) into a set of individual chemical components and provides estimations of their relative contribution to the total fluorescence (Bro 1997; Jason B Fellman, Hood, and Spencer 2010; Colin A. Stedmon, Markager, and Bro 2003). The PARAFAC model is described as (Bro 1997; Harshman 1970): \\[\\begin{equation} x_{ijk} = \\sum_{f=1}^{F} a_{ij}b_{jf}c_{kf} + e_{ijk} \\end{equation}\\] where \\(i = 1, ..., I\\); \\(j = 1, ..., J\\); \\(k = 1, ..., K\\), \\(x_{ijk}\\) is the intensity of fluorescence of the the \\(i^{th}\\) sample at the \\(j^{th}\\) emission wavelength at the \\(k^{th}\\) excitation wavelength. \\(a_{ij}\\) is directly proportional to the concentration of the \\(f^{th}\\) component in the sample \\(i\\). Although PARAFAC gained a lot of attention in environmental sciences, it is also widely used in other research fields such as medical, pharmaceutical, food, social and information sciences (Murphy et al. 2013). Until today, more than 1850 published scientific papers relying on PARAFAC have been identified on Web of Science. Although PARAFAC was made easier using the drEEM MATLAB toolbox (Murphy et al. 2013), preprocessing of EEMs prior to the analysis is still not straightforward. EEM preprocessing is an important part of PARAFAC since it aims to correct any systematic bias in the measurements and to remove signal unrelated to DOM fluorescence (Murphy et al. 2013). Biased models can be produced if these steps are not conducted carefully (see Hiriart-Baer, Diep, and Smith (2008) where scattering fluorescence signals have been modeled and wrongly interpreted). Such data processing is cumbersome as it involves many steps (Colin A Stedmon and Bro 2008; Murphy et al. 2013) which are usually executed by hand or within in-house scripting and therefore prone to introduce errors. Another important drawback limiting effective preprocessing of EEMs arise from the wide variety of file formats provided by the different manufacturers of spectrofluorometers that makes data importation difficult to generalize. Possibly reflecting these difficulties, it was recently pointed out that characterization of DOM using fluorescence spectroscopy is still not routinely included in ecological studies (Jason B Fellman, Hood, and Spencer 2010). Given the increasing interest for fluorescence spectroscopy in ecology, tools are needed to unify the main preprocessing steps needed for further analyzes such as PARAFAC or metric calculations. The purpose of the eemR R package is to provide a rapid and an elegant interface to perform preprocessing of EEMs as well as to extract common fluorescence-based metrics proposed in the literature to obtain quantitative information about the DOM pool. This paper presents theoretical and mathematical background of the main PARAFAC preprocessing steps and metric calculations with concrete code examples. References "],
["fluorescence-of-dom-theoretical-and-mathematical-background.html", "4.3 Fluorescence of DOM: theoretical and mathematical background", " 4.3 Fluorescence of DOM: theoretical and mathematical background Let us define \\(X\\), an EEM of fluorescence intensities measured along a vector of excitation wavelengths (\\(ex\\)) at emission wavelengths (\\(em\\)). Usually, \\(ex\\) and \\(em\\) vary, respectively, between 200-500 nm and 220-600 nm (Fig. 1). \\(X_{ex, em}\\) denotes the fluorescence intensity measured at excitation \\(ex\\) and emission \\(em\\) (ex.: \\(X_{250, 400}\\)). The following sections present the main correction steps for fluorescence data aiming to correct any systematic bias in the measurements and remove signal unrelated to fluorescence prior to any analysis. Correction Description Blank subtraction Subtract a pure water sample blank from the fluorescence data to help the removal of Raman and Rayleigh scattering peaks. Scattering removal Remove the the so-called scattering bands caused by first and second order of Raman and Rayleigh scattering. Inner-filter effect correction Correct for reabsorption of light occurring at both the excitation and emission wavelengths during measurement. Raman normalization Remove the dependency of fluorescence intensities from the measuring equipments thus allowing cross-study comparisons. 4.3.1 Scattering correction Rayleigh and Raman scattering are optical processes by which some of the incident energy can be absorbed and converted into vibrational and rotational energy (Lakowicz 2006). The resulting scattered energy produce the so-called scattering bands which are visually easily identifiable (Figs. 1 and 2). Given that both types of scattering are repeated across EEMs, it is important to remove such artifacts prior to analysis (Bahram et al. 2006; R. G. Zepp, Sheldon, and Moran 2004). FIGURE 4.2: Emission fluorescence emitted at excitation \\(ex = 350\\). First order of Rayleigh and Raman scattering regions are identified in blue and red. First order of Rayleigh scattering is defined as the region where emission is equal to excitation (\\(em = ex\\)) causing a diagonal band in the EEM (Fig. 1) whereas the second order of Rayleigh scattering occurs at two times the emission wavelength of the primary peak (\\(em = 2ex\\)). For water, Raman scattering occurs at a wavenumber 3 600 \\(cm^{-1}\\) (or \\(3.6 \\times 10^{10} nm^{-1}\\)) lower than the incident excitation wavenumber (Lakowicz 2006). Mathematically, first order Raman scattering is defined as follow: \\[\\begin{equation} \\text{Raman}_{\\text{1st}} = -\\frac{ex}{0.00036 ex - 1} \\label{eq:raman1} \\end{equation}\\] where \\(ex\\) is the incident excitation wavelength (nm). Second order Raman scattering is then simply defined as: \\[\\begin{equation} \\text{Raman}_{\\text{2nd}} = -\\frac{2ex}{0.00036 ex - 1} \\label{eq:raman2} \\end{equation}\\] Different interpolation techniques have been proposed to eliminate scattering (R. G. Zepp, Sheldon, and Moran 2004; Bahram et al. 2006). However, it is a common practice to simply remove the scattering-bands by inserting missing values (Fig. 3) at the corresponding positions (Murphy et al. 2013; Colin A Stedmon and Bro 2008). 4.3.2 Inner-filter effect correction The inner-filter effect (IFE) is an optical phenomenon of reabsorption of emitted light and occurs particularly in highly concentrated samples (Fig. 4). IFE is known to cause underestimation of fluorescence intensities especially at shorter wavelengths and even to alter the shape and the positioning of fluorescence spectra by shifting peak positions toward lower wavelengths (Fig. 4) with increasing concentration (Mobed et al. 1996; Kothawala et al. 2013). However, it was shown that the loss of fluorescence due to IFE could be estimated from absorbance spectra measured on the same sample using Equation (??) (Ohno 2002; Parker and Barnes 1957): \\[\\begin{equation} X_0 = \\frac{X}{10^{-b(A_{ex} + A_{em})}} \\label{eq:ife} \\end{equation}\\] where \\(X_0\\) is the fluorescence in the absence of IFE, \\(X\\) is the measured fluorescence intensity, \\(b\\) is half the cuvette pathlength (usually 0.5 cm) for excitation and emission absorbance, \\(A_{ex}\\) is the absorbance at the excitation wavelength \\(ex\\) and \\(A_{em}\\) the absorbance at the emission wavelength \\(em\\) (Fig. 4B). It was recently shown that IFE corrected algebraically was not appropriate when total absorbance, defined as \\(A_{\\text{total}} = A_{\\text{ex}} + A_{\\text{em}}\\) (see Equation (??)), is greater than 1.5 (Kothawala et al. 2013). Under this circumstance, a two-fold dilution of the sample has been recommended. If this happen, a warning message will be displayed by the package during the correction process. 4.3.3 Raman calibration The same DOM sample measured on different spectrofluorometers (or even the same but with different settings) can give important differences in fluorescence intensities (Lawaetz and Stedmon 2009; Paula G. Coble, Schultz, and Mopper 1993). The purpose of the Raman calibration is to remove the dependency of fluorescence intensities on the measuring equipment, thus allowing cross-study comparisons. Given that the Raman peak position of a water sample is located at a fixed position, (Lawaetz and Stedmon 2009) proposed to use the Raman integral of a blank-water sample measured the same day as the EEM to perform calibration. Moreover, the area of the Raman peak (\\(A_{\\text{rp}}\\), Fig. 5) is defined as the area of the emission profile between 371 and 428 nm at a fixed excitation of 350 nm (Lawaetz and Stedmon 2009). Mathematically, the value of \\(A_{\\text{rp}}\\) is calculated using the following integral (Equation(??)): \\[\\begin{equation} A_{\\text{rp}} = \\int\\limits_{\\lambda_{\\text{em}371}}^{\\lambda_{\\text{em}428}} W_{350, \\lambda} d\\lambda \\label{eq:arp} \\end{equation}\\] where \\(W_{350, \\lambda}\\) is the fluorescence intensity of a pure water sample (preferably deionized and ultraviolet exposed, Lawaetz and Stedmon (2009)) at excitation \\(ex = 350\\) nm and at emission \\(em = \\lambda\\) nm. Each values of the EEM \\(X\\) are then normalized using the scalar value of \\(A_{\\text{rp}}\\) accordingly to Equation @ref(eq:raman_normalisation): \\[\\begin{equation} X_0 = \\frac{X}{A_{\\text{rp}}} \\label{eq:raman_normalisation} \\end{equation}\\] where \\(X_0\\) is the normalized EEM with fluorescence intensities now expressed as Raman Units (R.U.), \\(X\\) are the unnormalized measured fluorescence intensities and \\(A_{\\text{rp}}\\) is the Raman peak area. 4.3.4 Metrics A wide range of different metrics obtained from EEMs have been proposed to characterize the DOM pool in aquatic ecosystems. These metrics extract quantitative information in specific regions (wavelengths) in EEMs. The following sections present an overview of the principal metrics supported by the package. 4.3.4.1 Coble’s peaks The following table presents the five major fluorescent components identified by (Paula G Coble 1996) in marine EEMs. Peaks B and T represent protein-like compounds (tyrosine and tryptophane), peaks A and C are indicators of humic-like components whereas peak M was associated to marine humic-like fluorescence. Peak Ex (nm) Em (nm) B 275 310 T 275 340 A 260 380-460 M 312 380-420 C 350 420-480 4.3.4.2 Fluorescence, humification and biological indices Three main indices have been proposed to trace the diagnostic state of the DOM pool in aquatic ecosystems. The fluorescence index (FI) was shown to be a good indicator of the general source and aromaticity of DOM in lakes, streams and rivers (McKnight et al. 2001). This index is calculated as the ratio of fluorescence at emission 450 nm and 500 nm, at fixed excitation of 370 nm (Equation (??)). \\[\\begin{equation} \\text{FI} = \\frac{X_{370, 450}}{X_{370, 500}} \\label{eq:fi} \\end{equation}\\] The humification index (HIX) is a measure of the complexity and the aromatic nature of DOM (Ohno 2002). HIX calculated as the ratio of the sum of the fluorescence between 435 and 480 nm and between 300 and 345 nm at a fixed excitation of 254 nm (Equation (??)). \\[\\begin{equation} \\text{HIX} = \\frac{\\sum\\limits_{em = 435}^{480} X_{254, em}}{\\sum\\limits_{em = 300}^{345} X_{254, em}} \\label{eq:hix} \\end{equation}\\] The biological index (BIX) is a measure to characterize biological production of DOM (Huguet et al. 2009). BIX is calculated at excitation 310 nm, by dividing the fluorescence intensity emitted at emission 380 nm and at 430 nm (Equation ((??))). \\[\\begin{equation} \\text{BIX} = \\frac{X_{310, 380}}{X_{310, 430}} \\label{eq:bix} \\end{equation}\\] References "],
["r-code-and-study-case.html", "4.4 R code and study case", " 4.4 R code and study case Main preprocessing steps using the eemR package are illustrated using a subset of three EEMs from (Massicotte and Frenette 2011). Briefly, these EEMs (see Fig. 1 for an example) have been sampled in the St. Lawrence River, one of the largest rivers in North America. Fluorescence matrices of DOM were measured on a Cary Eclipse spectrofluorometer (Varian, Mississauga, Ontario, Canada) over excitation wavelengths between 220 and 450 nm (5-nm increment) and emission wavelengths between 230 and 600 nm (2-nm increment). All functions from the package start with the prefix 'eem_'. library(eemR) ls(&quot;package:eemR&quot;) ## [1] &quot;absorbance&quot; &quot;eem_bind&quot; ## [3] &quot;eem_biological_index&quot; &quot;eem_coble_peaks&quot; ## [5] &quot;eem_cut&quot; &quot;eem_export_matlab&quot; ## [7] &quot;eem_extract&quot; &quot;eem_fluorescence_index&quot; ## [9] &quot;eem_humification_index&quot; &quot;eem_inner_filter_effect&quot; ## [11] &quot;eem_names&quot; &quot;eem_names&lt;-&quot; ## [13] &quot;eem_raman_normalisation&quot; &quot;eem_read&quot; ## [15] &quot;eem_remove_blank&quot; &quot;eem_remove_scattering&quot; ## [17] &quot;eem_set_wavelengths&quot; 4.4.1 Data importation and plotting Importation of EEMs into R is done using the eem_read() function. Given that fluorescence files are dependent on the spectrofluorometer used, eemR will determine automatically from which manufacturer the files are from and load them accordingly. file &lt;- system.file(&quot;extdata/cary/scans_day_1&quot;, package = &quot;eemR&quot;) eems &lt;- eem_read(file) The generic summary() function displays useful information such as: (1) the wavelength ranges used in both emission and excitation modes, (2) the manufacturer from which the file was read and (3) the state of the EEM which indicate which corrections have been applied. summary(eems) ## sample ex_min ex_max em_min em_max is_blank_corrected ## 1 nano 220 450 230 600 FALSE ## 2 sample1 220 450 230 600 FALSE ## 3 sample2 220 450 230 600 FALSE ## 4 sample3 220 450 230 600 FALSE ## is_scatter_corrected is_ife_corrected is_raman_normalized manufacturer ## 1 FALSE FALSE FALSE Cary Eclipse ## 2 FALSE FALSE FALSE Cary Eclipse ## 3 FALSE FALSE FALSE Cary Eclipse ## 4 FALSE FALSE FALSE Cary Eclipse A surface plot of EEMs is made using the plot(x, which = 1) function where which is the index of the EEM to be plotted (see Fig. 3). plot(eems, which = 3) Interactive plots using a simple shiny app can be lunched to interactively browse EEMs. plot(eems, interactive = TRUE) 4.4.2 Blank subtraction Subtraction of a water blank from the measured samples may help to reduce scattering (Murphy et al. 2013; Colin A Stedmon and Bro 2008). In eemR, this is done using the eem_remove_blank(eem, blank) function where eem is a list of EEMs and blank is a water blank. file &lt;- system.file(&quot;extdata/cary/scans_day_1&quot;, &quot;nano.csv&quot;, package = &quot;eemR&quot;) blank &lt;- eem_read(file) eems &lt;- eem_remove_blank(eems, blank) 4.4.3 Raman and Rayleigh scattering removal Scattering removal (Equation (??) and Equation (??)) is performed using the eem_remove_scattering(eem, type, order, width) function where eem is a list of EEMs, type is the scattering type (raman or rayleigh), order is the order of the scattering (1 or 2) and width the width in nanometers of the slit windows to be removed. In the following example, only first order and Raman and Rayleigh scattering are removed using a bandwidth of 10 nm (Fig. 3). eems &lt;- eem_remove_scattering(eems, &quot;rayleigh&quot;, 1, 10) %&gt;% eem_remove_scattering(&quot;raman&quot;, 1, 10) plot(eems, which = 3) FIGURE 4.3: Fluorescence profile of a pure water sample at excitation 350 nm between 300 and 450 nm emission. The area of the Raman peak is identified by the shaded polygon and is calculated using Equation xxx. 4.4.4 Inner-filter effect correction IFE correction requires the use of absorbance data (Equation (??)). For each EEM, an absorbance spectra must be supplied. The easiest way to provide absorbance is to use a data frame with column names matching EEMs names. In the following data frame, the first column represents the wavelengths at which absorbance have been measured whereas the remaining columns are absorbance spectra for sample1, sample2 and sample3. data(&quot;absorbance&quot;) head(absorbance) ## wavelength sample1 sample2 sample3 ## 1 190 0.89674 1.02927 1.19405 ## 2 191 0.84894 0.96381 1.13721 ## 3 192 0.77267 0.85339 1.04520 ## 4 193 0.70967 0.75627 0.96782 ## 5 194 0.65459 0.67145 0.90092 ## 6 195 0.61371 0.60745 0.85054 Note that EEM names can be obtained using the eem_sample_names() function. eem_names(eems) ## [1] &quot;nano&quot; &quot;sample1&quot; &quot;sample2&quot; &quot;sample3&quot; IFE correction is performed using the eem_inner_filter_effect(eem, absorbance, pathlength) function where eem is a list of EEMs, absorbance is a data frame containing absorbance spectra and pathlength is the absorbance cuvette pathlength expressed in \\(cm\\) (Fig. 4B). For each EEM contained in eem, the ranges spanned by the IFE correction factors and total absorbance \\(A_{\\text{total}}\\) (Equation (??)) are displayed to the user. This can serve as diagnostic tool to determine if the mathematical correction was the appropriate method to use to handle IFE. eems &lt;- eem_inner_filter_effect(eem = eems, absorbance = absorbance, pathlength = 1) ## Warning: Absorbance spectrum for nano was not found. Returning uncorrected ## EEM. ## sample1 ## Range of IFE correction factors: 1.0112 1.5546 ## Range of total absorbance (Atotal) : 0.0096 0.3832 ## ## sample2 ## Range of IFE correction factors: 1.0061 1.3124 ## Range of total absorbance (Atotal) : 0.0053 0.2362 ## ## sample3 ## Range of IFE correction factors: 1.016 2.3713 ## Range of total absorbance (Atotal) : 0.0138 0.75 plot(eems, which = 3) Fig. 4 presents intermediate results obtained for the correction of sample3. Note the nonlinearity of the correction with higher effect at lower wavelengths (bottom-left corner in panel C). The corrected EEM is presented in Fig. 4D which is the result of the operation of dividing matrix in 4A by 4C. 4.4.5 Raman normalization The last step of the correction process consist to calibrate fluorescence intensities using the Raman scatter peak of water (Lawaetz and Stedmon 2009). This is performed using the eem_raman_normalisation(eem, blank) function where eem is a list of EEMs and blank is a water blank measured the same day. Here, the same water-blank is used for the three EEMs. Note that the value of the Raman area (\\(A_{\\text{rp}}\\), Equation(??)) is printed. eems &lt;- eem_raman_normalisation(eems, blank) ## Raman area: 9.540904 ## Raman area: 9.540904 ## Raman area: 9.540904 plot(eems, which = 3) At this stage, all corrections have been performed and EEMs are ready to be exported into MATLAB for PARAFAC analysis. The state of the EEMs can be verified using the summary() function. summary(eems) ## sample ex_min ex_max em_min em_max is_blank_corrected ## 1 nano 220 450 230 600 FALSE ## 2 sample1 220 450 230 600 TRUE ## 3 sample2 220 450 230 600 TRUE ## 4 sample3 220 450 230 600 TRUE ## is_scatter_corrected is_ife_corrected is_raman_normalized manufacturer ## 1 TRUE FALSE FALSE Cary Eclipse ## 2 TRUE TRUE TRUE Cary Eclipse ## 3 TRUE TRUE TRUE Cary Eclipse ## 4 TRUE TRUE TRUE Cary Eclipse 4.4.6 Exporting to MATLAB The drEEM MATLAB toolbox (Murphy et al. 2013) used to perform PARAFAC analysis requires data in a specific format (structure). The eem_export_matlab(file, ...) function can be used to export corrected EEMs into a PARAFAC ready format. The first file argument is the mat file where to export the structure and the second argument ... is one or more eem object. eem_export_matlab(&quot;myfile.mat&quot;, eems) Once exported, one can simply import the generated mat file in MATLAB using load('myfile.mat');. 4.4.7 Metric extraction Coble’s peaks can be extracted using the eem_coble_peaks(eem) function. Note that for peaks A, M, C, the maximum fluorescence intensity in the range of emission region is returned. file &lt;- system.file(&quot;extdata/cary/scans_day_1&quot;, package = &quot;eemR&quot;) eems &lt;- eem_read(file) eem_coble_peaks(eems, verbose = FALSE) ## sample b t a m c ## 1 nano 0.8745673 0.1401188 0.140175 0.09653326 0.1255788 ## 2 sample1 1.5452981 1.0603312 3.731836 2.42409567 1.8149415 ## 3 sample2 1.2629968 0.6647042 1.583489 1.02359302 0.7709074 ## 4 sample3 1.4740862 1.3162812 8.416034 6.06335506 6.3179129 Fluorescence (FI), humification (HIX) and biological (BIX) indices can be extracted as follow. eem_fluorescence_index(eems, verbose = FALSE) ## sample fi ## 1 nano -0.5932057 ## 2 sample1 1.2647823 ## 3 sample2 1.4553330 ## 4 sample3 1.3294132 eem_humification_index(eems, verbose = FALSE) ## sample hix ## 1 nano 0.5568136 ## 2 sample1 6.3795618 ## 3 sample2 4.2548483 ## 4 sample3 13.0246234 eem_biological_index(eems, verbose = FALSE) ## sample bix ## 1 nano 2.6812045 ## 2 sample1 0.7062640 ## 3 sample2 0.8535423 ## 4 sample3 0.4867927 It should be noted that different excitation and emission wavelengths are often used to measure EEMs. Hence, it is possible to have mismatch between measured wavelengths and wavelengths used to calculate specific metrics. In these circumstances, EEMs are interpolated using the the pracma package (Borchers 2015). A message warning the user will be displayed if data interpolation is performed. This behavior can be controlled using the verbose = TRUE/FALSE parameter. References "],
["using-r-pipeline.html", "4.5 Using R pipeline", " 4.5 Using R pipeline Note that it is also possible to use the magrittr pipe line with most functions from eemR. library(magrittr) file &lt;- system.file(&quot;extdata/cary/scans_day_1/&quot;, package = &quot;eemR&quot;) file %&gt;% eem_read(recursive = TRUE) %&gt;% eem_raman_normalisation() %&gt;% eem_remove_scattering(type = &quot;raman&quot;, order = 1, width = 10) %&gt;% eem_remove_scattering(type = &quot;rayleigh&quot;, order = 1, width = 10) %&gt;% plot(2) -->"],
["definitions.html", "Chapter 5 Definitions", " Chapter 5 Definitions Acronym Definition Reference DOM Dissolved organic matter DOC Dissolved organic carbon CDOM Chromophoric dissolved organic matter SUVA\\(_{254}\\) Specific UV absorbance at 254 nm Weishaar et al. (2003) S\\(_\\text{R}\\) Slope ratio Helms et al. (2008) \\(a_\\text{CDOM}\\) Absorption coefficient of CDOM (m\\(^{-1}\\)) \\(S_\\lambda\\) Spectral slope curve Loiselle et al. (2009) FMAX FDOM Fluorescent dissolved organic matter S Spectral slope (nm\\(^{-1}\\)) \\(\\lambda\\) Greek symbol referring to wavelength (nm) "]
]
