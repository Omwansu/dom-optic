<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Practical guide on dissolved organic matter (DOM) optic</title>
  <meta name="description" content="A practical guide on dissolved organic matter optic.">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Practical guide on dissolved organic matter (DOM) optic" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A practical guide on dissolved organic matter optic." />
  <meta name="github-repo" content="PMassicotte/dom-optic" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Practical guide on dissolved organic matter (DOM) optic" />
  
  <meta name="twitter:description" content="A practical guide on dissolved organic matter optic." />
  

<meta name="author" content="Philippe Massicotte">


<meta name="date" content="2017-07-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="fluorescence-of-dom-theoretical-and-mathematical-background.html">
<link rel="next" href="using-r-pipeline.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Practical guide on dissolved organic matter (DOM) optic</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction and motivations</a></li>
<li class="chapter" data-level="2" data-path="measurements.html"><a href="measurements.html"><i class="fa fa-check"></i><b>2</b> Measurements</a><ul>
<li class="chapter" data-level="2.1" data-path="dom-measurements.html"><a href="dom-measurements.html"><i class="fa fa-check"></i><b>2.1</b> DOM measurements</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="absorbance.html"><a href="absorbance.html"><i class="fa fa-check"></i><b>3</b> Absorbance</a><ul>
<li class="chapter" data-level="3.1" data-path="what-is-cdom.html"><a href="what-is-cdom.html"><i class="fa fa-check"></i><b>3.1</b> What is CDOM?</a></li>
<li class="chapter" data-level="3.2" data-path="writing-and-notation.html"><a href="writing-and-notation.html"><i class="fa fa-check"></i><b>3.2</b> Writing and notation</a></li>
<li class="chapter" data-level="3.3" data-path="absorption-vs-absorbance.html"><a href="absorption-vs-absorbance.html"><i class="fa fa-check"></i><b>3.3</b> Absorption vs absorbance</a></li>
<li class="chapter" data-level="3.4" data-path="mathematical-formulation-of-absorption-spectra.html"><a href="mathematical-formulation-of-absorption-spectra.html"><i class="fa fa-check"></i><b>3.4</b> Mathematical formulation of absorption spectra</a></li>
<li class="chapter" data-level="3.5" data-path="sl.html"><a href="sl.html"><i class="fa fa-check"></i><b>3.5</b> Modeling CDOM absorption spectra in R</a><ul>
<li class="chapter" data-level="3.5.1" data-path="sl.html"><a href="sl.html#potential-drawbacks"><i class="fa fa-check"></i><b>3.5.1</b> Potential drawbacks</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="metrics.html"><a href="metrics.html"><i class="fa fa-check"></i><b>3.6</b> Metrics</a><ul>
<li class="chapter" data-level="3.6.1" data-path="metrics.html"><a href="metrics.html#slope-ratio"><i class="fa fa-check"></i><b>3.6.1</b> Slope ratio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="fluorescence.html"><a href="fluorescence.html"><i class="fa fa-check"></i><b>4</b> Fluorescence</a><ul>
<li class="chapter" data-level="4.1" data-path="what-is-a-eem.html"><a href="what-is-a-eem.html"><i class="fa fa-check"></i><b>4.1</b> What is a EEM</a></li>
<li class="chapter" data-level="4.2" data-path="parafac.html"><a href="parafac.html"><i class="fa fa-check"></i><b>4.2</b> PARAFAC</a></li>
<li class="chapter" data-level="4.3" data-path="fluorescence-of-dom-theoretical-and-mathematical-background.html"><a href="fluorescence-of-dom-theoretical-and-mathematical-background.html"><i class="fa fa-check"></i><b>4.3</b> Fluorescence of DOM: theoretical and mathematical background</a><ul>
<li class="chapter" data-level="4.3.1" data-path="fluorescence-of-dom-theoretical-and-mathematical-background.html"><a href="fluorescence-of-dom-theoretical-and-mathematical-background.html#scattering-correction"><i class="fa fa-check"></i><b>4.3.1</b> Scattering correction</a></li>
<li class="chapter" data-level="4.3.2" data-path="fluorescence-of-dom-theoretical-and-mathematical-background.html"><a href="fluorescence-of-dom-theoretical-and-mathematical-background.html#inner-filter-effect-correction"><i class="fa fa-check"></i><b>4.3.2</b> Inner-filter effect correction</a></li>
<li class="chapter" data-level="4.3.3" data-path="fluorescence-of-dom-theoretical-and-mathematical-background.html"><a href="fluorescence-of-dom-theoretical-and-mathematical-background.html#raman-calibration"><i class="fa fa-check"></i><b>4.3.3</b> Raman calibration</a></li>
<li class="chapter" data-level="4.3.4" data-path="fluorescence-of-dom-theoretical-and-mathematical-background.html"><a href="fluorescence-of-dom-theoretical-and-mathematical-background.html#metrics-1"><i class="fa fa-check"></i><b>4.3.4</b> Metrics</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="r-code-and-study-case.html"><a href="r-code-and-study-case.html"><i class="fa fa-check"></i><b>4.4</b> R code and study case</a><ul>
<li class="chapter" data-level="4.4.1" data-path="r-code-and-study-case.html"><a href="r-code-and-study-case.html#data-importation-and-plotting"><i class="fa fa-check"></i><b>4.4.1</b> Data importation and plotting</a></li>
<li class="chapter" data-level="4.4.2" data-path="r-code-and-study-case.html"><a href="r-code-and-study-case.html#blank-subtraction"><i class="fa fa-check"></i><b>4.4.2</b> Blank subtraction</a></li>
<li class="chapter" data-level="4.4.3" data-path="r-code-and-study-case.html"><a href="r-code-and-study-case.html#raman-and-rayleigh-scattering-removal"><i class="fa fa-check"></i><b>4.4.3</b> Raman and Rayleigh scattering removal</a></li>
<li class="chapter" data-level="4.4.4" data-path="r-code-and-study-case.html"><a href="r-code-and-study-case.html#inner-filter-effect-correction-1"><i class="fa fa-check"></i><b>4.4.4</b> Inner-filter effect correction</a></li>
<li class="chapter" data-level="4.4.5" data-path="r-code-and-study-case.html"><a href="r-code-and-study-case.html#raman-normalization"><i class="fa fa-check"></i><b>4.4.5</b> Raman normalization</a></li>
<li class="chapter" data-level="4.4.6" data-path="r-code-and-study-case.html"><a href="r-code-and-study-case.html#exporting-to-matlab"><i class="fa fa-check"></i><b>4.4.6</b> Exporting to MATLAB</a></li>
<li class="chapter" data-level="4.4.7" data-path="r-code-and-study-case.html"><a href="r-code-and-study-case.html#metric-extraction"><i class="fa fa-check"></i><b>4.4.7</b> Metric extraction</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="using-r-pipeline.html"><a href="using-r-pipeline.html"><i class="fa fa-check"></i><b>4.5</b> Using R pipeline</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="definitions.html"><a href="definitions.html"><i class="fa fa-check"></i><b>5</b> Definitions</a></li>
<li class="chapter" data-level="6" data-path="test.html"><a href="test.html"><i class="fa fa-check"></i><b>6</b> Absorbance</a></li>
<li class="divider"></li>
<li><a href="https://github.com/PMassicotte/dom-optic" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical guide on dissolved organic matter (DOM) optic</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-code-and-study-case" class="section level2">
<h2><span class="header-section-number">4.4</span> R code and study case</h2>
<p>Main preprocessing steps using the <strong>eemR</strong> package are illustrated using a subset of three EEMs from <span class="citation">(Massicotte and Frenette <a href="#ref-Massicotte2011EA">2011</a>)</span>. Briefly, these EEMs (see Fig. 1 for an example) have been sampled in the St. Lawrence River, one of the largest rivers in North America. Fluorescence matrices of DOM were measured on a Cary Eclipse spectrofluorometer (Varian, Mississauga, Ontario, Canada) over excitation wavelengths between 220 and 450 nm (5-nm increment) and emission wavelengths between 230 and 600 nm (2-nm increment). All functions from the package start with the prefix <code>'eem_'</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(eemR)
<span class="kw">ls</span>(<span class="st">&quot;package:eemR&quot;</span>)</code></pre></div>
<pre><code>##  [1] &quot;absorbance&quot;              &quot;eem_bind&quot;               
##  [3] &quot;eem_biological_index&quot;    &quot;eem_coble_peaks&quot;        
##  [5] &quot;eem_cut&quot;                 &quot;eem_export_matlab&quot;      
##  [7] &quot;eem_extract&quot;             &quot;eem_fluorescence_index&quot; 
##  [9] &quot;eem_humification_index&quot;  &quot;eem_inner_filter_effect&quot;
## [11] &quot;eem_names&quot;               &quot;eem_names&lt;-&quot;            
## [13] &quot;eem_raman_normalisation&quot; &quot;eem_read&quot;               
## [15] &quot;eem_remove_blank&quot;        &quot;eem_remove_scattering&quot;  
## [17] &quot;eem_set_wavelengths&quot;</code></pre>
<div id="data-importation-and-plotting" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Data importation and plotting</h3>
<p>Importation of EEMs into R is done using the <code>eem_read()</code> function. Given that fluorescence files are dependent on the spectrofluorometer used, <code>eemR</code> will determine automatically from which manufacturer the files are from and load them accordingly.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/cary/scans_day_1&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;eemR&quot;</span>)
eems &lt;-<span class="st"> </span><span class="kw">eem_read</span>(file)</code></pre></div>
<p>The generic <code>summary()</code> function displays useful information such as: (1) the wavelength ranges used in both emission and excitation modes, (2) the manufacturer from which the file was read and (3) the state of the EEM which indicate which corrections have been applied.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(eems)</code></pre></div>
<pre><code>##    sample ex_min ex_max em_min em_max is_blank_corrected
## 1    nano    220    450    230    600              FALSE
## 2 sample1    220    450    230    600              FALSE
## 3 sample2    220    450    230    600              FALSE
## 4 sample3    220    450    230    600              FALSE
##   is_scatter_corrected is_ife_corrected is_raman_normalized manufacturer
## 1                FALSE            FALSE               FALSE Cary Eclipse
## 2                FALSE            FALSE               FALSE Cary Eclipse
## 3                FALSE            FALSE               FALSE Cary Eclipse
## 4                FALSE            FALSE               FALSE Cary Eclipse</code></pre>
<p>A surface plot of EEMs is made using the <code>plot(x, which = 1)</code> function where <code>which</code> is the index of the EEM to be plotted (see Fig. 3).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(eems, <span class="dt">which =</span> <span class="dv">3</span>)</code></pre></div>
<p>Interactive plots using a simple shiny app can be lunched to interactively browse EEMs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(eems, <span class="dt">interactive =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="blank-subtraction" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Blank subtraction</h3>
<p>Subtraction of a water blank from the measured samples may help to reduce scattering <span class="citation">(Murphy et al. <a href="#ref-Murphy2013">2013</a>; Colin A Stedmon and Bro <a href="#ref-Stedmon2008">2008</a>)</span>. In <code>eemR</code>, this is done using the <code>eem_remove_blank(eem, blank)</code> function where <code>eem</code> is a list of EEMs and <code>blank</code> is a water blank.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/cary/scans_day_1&quot;</span>, <span class="st">&quot;nano.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;eemR&quot;</span>)
blank &lt;-<span class="st"> </span><span class="kw">eem_read</span>(file)

eems &lt;-<span class="st"> </span><span class="kw">eem_remove_blank</span>(eems, blank)</code></pre></div>
</div>
<div id="raman-and-rayleigh-scattering-removal" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Raman and Rayleigh scattering removal</h3>
<p>Scattering removal (Equation <a href="#eq:raman1">(<strong>??</strong>)</a> and Equation <a href="#eq:raman2">(<strong>??</strong>)</a>) is performed using the <code>eem_remove_scattering(eem, type, order, width)</code> function where <code>eem</code> is a list of EEMs, <code>type</code> is the scattering type (<code>raman</code> or <code>rayleigh</code>), <code>order</code> is the order of the scattering (1 or 2) and <code>width</code> the width in nanometers of the slit windows to be removed. In the following example, only first order and Raman and Rayleigh scattering are removed using a bandwidth of 10 nm (Fig. 3).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eems &lt;-<span class="st"> </span><span class="kw">eem_remove_scattering</span>(eems, <span class="st">&quot;rayleigh&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">eem_remove_scattering</span>(<span class="st">&quot;raman&quot;</span>, <span class="dv">1</span>, <span class="dv">10</span>)

<span class="kw">plot</span>(eems, <span class="dt">which =</span> <span class="dv">3</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig5"></span>
<img src="dom_optic_files/figure-html/fig5-1.svg" alt="Fluorescence profile of a pure water sample at excitation 350 nm between 300 and 450 nm emission. The area of the Raman peak is identified by the shaded polygon and is calculated using Equation xxx." width="672" />
<p class="caption">
FIGURE 4.3: Fluorescence profile of a pure water sample at excitation 350 nm between 300 and 450 nm emission. The area of the Raman peak is identified by the shaded polygon and is calculated using Equation xxx.
</p>
</div>
</div>
<div id="inner-filter-effect-correction-1" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Inner-filter effect correction</h3>
<p>IFE correction requires the use of absorbance data (Equation <a href="#eq:ife">(<strong>??</strong>)</a>). For each EEM, an absorbance spectra must be supplied. The easiest way to provide absorbance is to use a data frame with column names matching EEMs names. In the following data frame, the first column represents the wavelengths at which absorbance have been measured whereas the remaining columns are absorbance spectra for <code>sample1</code>, <code>sample2</code> and <code>sample3</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;absorbance&quot;</span>)
<span class="kw">head</span>(absorbance)</code></pre></div>
<pre><code>##   wavelength sample1 sample2 sample3
## 1        190 0.89674 1.02927 1.19405
## 2        191 0.84894 0.96381 1.13721
## 3        192 0.77267 0.85339 1.04520
## 4        193 0.70967 0.75627 0.96782
## 5        194 0.65459 0.67145 0.90092
## 6        195 0.61371 0.60745 0.85054</code></pre>
<p>Note that EEM names can be obtained using the <code>eem_sample_names()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">eem_names</span>(eems)</code></pre></div>
<pre><code>## [1] &quot;nano&quot;    &quot;sample1&quot; &quot;sample2&quot; &quot;sample3&quot;</code></pre>
<p>IFE correction is performed using the <code>eem_inner_filter_effect(eem, absorbance, pathlength)</code> function where <code>eem</code> is a list of EEMs, <code>absorbance</code> is a data frame containing absorbance spectra and <code>pathlength</code> is the absorbance cuvette pathlength expressed in <span class="math inline">\(cm\)</span> (Fig. 4B). For each EEM contained in <code>eem</code>, the ranges spanned by the IFE correction factors and total absorbance <span class="math inline">\(A_{\text{total}}\)</span> (Equation <a href="#eq:ife">(<strong>??</strong>)</a>) are displayed to the user. This can serve as diagnostic tool to determine if the mathematical correction was the appropriate method to use to handle IFE.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eems &lt;-<span class="st"> </span><span class="kw">eem_inner_filter_effect</span>(<span class="dt">eem =</span> eems,
                                <span class="dt">absorbance =</span> absorbance,
                                <span class="dt">pathlength =</span> <span class="dv">1</span>)</code></pre></div>
<pre><code>## Warning: Absorbance spectrum for nano was not found. Returning uncorrected
## EEM.</code></pre>
<pre><code>## sample1 
## Range of IFE correction factors: 1.0112 1.5546 
## Range of total absorbance (Atotal) : 0.0096 0.3832 
## 
## sample2 
## Range of IFE correction factors: 1.0061 1.3124 
## Range of total absorbance (Atotal) : 0.0053 0.2362 
## 
## sample3 
## Range of IFE correction factors: 1.016 2.3713 
## Range of total absorbance (Atotal) : 0.0138 0.75</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(eems, <span class="dt">which =</span> <span class="dv">3</span>)</code></pre></div>
<p>Fig. 4 presents intermediate results obtained for the correction of <code>sample3</code>. Note the nonlinearity of the correction with higher effect at lower wavelengths (bottom-left corner in panel C). The corrected EEM is presented in Fig. 4D which is the result of the operation of dividing matrix in 4A by 4C.</p>
</div>
<div id="raman-normalization" class="section level3">
<h3><span class="header-section-number">4.4.5</span> Raman normalization</h3>
<p>The last step of the correction process consist to calibrate fluorescence intensities using the Raman scatter peak of water <span class="citation">(Lawaetz and Stedmon <a href="#ref-Lawaetz2009">2009</a>)</span>. This is performed using the <code>eem_raman_normalisation(eem, blank)</code> function where <code>eem</code> is a list of EEMs and <code>blank</code> is a water blank measured the same day. Here, the same water-blank is used for the three EEMs. Note that the value of the Raman area (<span class="math inline">\(A_{\text{rp}}\)</span>, Equation<a href="#eq:arp">(<strong>??</strong>)</a>) is printed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eems &lt;-<span class="st"> </span><span class="kw">eem_raman_normalisation</span>(eems, blank)</code></pre></div>
<pre><code>## Raman area: 9.540904 
## Raman area: 9.540904 
## Raman area: 9.540904</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(eems, <span class="dt">which =</span> <span class="dv">3</span>)</code></pre></div>
<p>At this stage, all corrections have been performed and EEMs are ready to be exported into MATLAB for PARAFAC analysis. The state of the EEMs can be verified using the <code>summary()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(eems)</code></pre></div>
<pre><code>##    sample ex_min ex_max em_min em_max is_blank_corrected
## 1    nano    220    450    230    600              FALSE
## 2 sample1    220    450    230    600               TRUE
## 3 sample2    220    450    230    600               TRUE
## 4 sample3    220    450    230    600               TRUE
##   is_scatter_corrected is_ife_corrected is_raman_normalized manufacturer
## 1                 TRUE            FALSE               FALSE Cary Eclipse
## 2                 TRUE             TRUE                TRUE Cary Eclipse
## 3                 TRUE             TRUE                TRUE Cary Eclipse
## 4                 TRUE             TRUE                TRUE Cary Eclipse</code></pre>
</div>
<div id="exporting-to-matlab" class="section level3">
<h3><span class="header-section-number">4.4.6</span> Exporting to MATLAB</h3>
<p>The <strong>drEEM</strong> MATLAB toolbox <span class="citation">(Murphy et al. <a href="#ref-Murphy2013">2013</a>)</span> used to perform PARAFAC analysis requires data in a specific format (structure). The <code>eem_export_matlab(file, ...)</code> function can be used to export corrected EEMs into a PARAFAC ready format. The first <code>file</code> argument is the mat file where to export the structure and the second argument <code>...</code> is one or more <code>eem</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">eem_export_matlab</span>(<span class="st">&quot;myfile.mat&quot;</span>, eems)</code></pre></div>
<p>Once exported, one can simply import the generated mat file in MATLAB using <code>load('myfile.mat');</code>.</p>
</div>
<div id="metric-extraction" class="section level3">
<h3><span class="header-section-number">4.4.7</span> Metric extraction</h3>
<p>Coble’s peaks can be extracted using the <code>eem_coble_peaks(eem)</code> function. Note that for peaks <strong>A, M, C</strong>, the maximum fluorescence intensity in the range of emission region is returned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/cary/scans_day_1&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;eemR&quot;</span>)
eems &lt;-<span class="st"> </span><span class="kw">eem_read</span>(file)

<span class="kw">eem_coble_peaks</span>(eems, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##    sample         b         t        a          m         c
## 1    nano 0.8745673 0.1401188 0.140175 0.09653326 0.1255788
## 2 sample1 1.5452981 1.0603312 3.731836 2.42409567 1.8149415
## 3 sample2 1.2629968 0.6647042 1.583489 1.02359302 0.7709074
## 4 sample3 1.4740862 1.3162812 8.416034 6.06335506 6.3179129</code></pre>
<p>Fluorescence (FI), humification (HIX) and biological (BIX) indices can be extracted as follow.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">eem_fluorescence_index</span>(eems, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##    sample         fi
## 1    nano -0.5932057
## 2 sample1  1.2647823
## 3 sample2  1.4553330
## 4 sample3  1.3294132</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">eem_humification_index</span>(eems, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##    sample        hix
## 1    nano  0.5568136
## 2 sample1  6.3795618
## 3 sample2  4.2548483
## 4 sample3 13.0246234</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">eem_biological_index</span>(eems, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##    sample       bix
## 1    nano 2.6812045
## 2 sample1 0.7062640
## 3 sample2 0.8535423
## 4 sample3 0.4867927</code></pre>
<p>It should be noted that different excitation and emission wavelengths are often used to measure EEMs. Hence, it is possible to have mismatch between measured wavelengths and wavelengths used to calculate specific metrics. In these circumstances, EEMs are interpolated using the the <code>pracma</code> package <span class="citation">(Borchers <a href="#ref-Borchers2015">2015</a>)</span>. A message warning the user will be displayed if data interpolation is performed. This behavior can be controlled using the <code>verbose = TRUE/FALSE</code> parameter.</p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Massicotte2011EA">
<p>Massicotte, Philippe, and Jean-Jacques Frenette. 2011. “Spatial connectivity in a large river system: resolving the sources and fate of dissolved organic matter.” <em>Ecological Applications</em> 21 (7): 2600–2617. doi:<a href="https://doi.org/10.1890/10-1475.1">10.1890/10-1475.1</a>.</p>
</div>
<div id="ref-Murphy2013">
<p>Murphy, Kathleen R., Colin a. Stedmon, Daniel Graeber, and Rasmus Bro. 2013. “Fluorescence spectroscopy and multi-way techniques. PARAFAC.” <em>Analytical Methods</em> 5 (23): 6557. doi:<a href="https://doi.org/10.1039/c3ay41160e">10.1039/c3ay41160e</a>.</p>
</div>
<div id="ref-Stedmon2008">
<p>Stedmon, Colin A, and Rasmus Bro. 2008. “Characterizing dissolved organic matter fluorescence with parallel factor analysis: a tutorial.” <em>Limnology and Oceanography: Methods</em> 6 (11): 572–79. doi:<a href="https://doi.org/10.4319/lom.2008.6.572">10.4319/lom.2008.6.572</a>.</p>
</div>
<div id="ref-Lawaetz2009">
<p>Lawaetz, A J, and C A Stedmon. 2009. “Fluorescence Intensity Calibration Using the Raman Scatter Peak of Water.” <em>Applied Spectroscopy</em> 63 (8): 936–40. doi:<a href="https://doi.org/10.1366/000370209788964548">10.1366/000370209788964548</a>.</p>
</div>
<div id="ref-Borchers2015">
<p>Borchers, Hans Werner. 2015. “pracma: Practical Numerical Math Functions.” <a href="https://cran.r-project.org/package=pracma" class="uri">https://cran.r-project.org/package=pracma</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fluorescence-of-dom-theoretical-and-mathematical-background.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="using-r-pipeline.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/PMassicotte/dom-optic/edit/master/03-fluorescence.Rmd",
"text": "Edit"
},
"download": ["dom_optic.pdf", "dom_optic.epub", "dom_optic.mobi"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
